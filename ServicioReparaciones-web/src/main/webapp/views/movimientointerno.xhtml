<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">
        <h:form id="fford">
            <p:panel>
                <h:panelGrid columns="8" cellpadding="5">
                    <p:outputLabel for="findOrd" value="Buscar por:"/>
                    <p:selectOneMenu id="findOrd" required="true" 
                                     value="#{movimientoInternoBean.pattern}">
                        <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                        <f:selectItem itemLabel="Cédula" itemValue="CLI01"/>
                        <f:selectItem itemLabel="Teléfono" itemValue="CLI02"/>
                        <f:selectItem itemLabel="Movil" itemValue="CLI03"/>
                        <f:selectItem itemLabel="Serie" itemValue="PRO02"/>
                        <f:selectItem itemLabel="PNC" itemValue="PRO03"/>
                        <f:selectItem itemLabel="Placa" itemValue="PRO04"/>
                        <f:selectItem itemLabel="Código ORD" itemValue="ORD01"/>
                        <f:selectItem itemLabel="Número ORD" itemValue="ORD02"/>
                        <f:selectItem itemLabel="Número Ticket" itemValue="ORD03"/>
                    </p:selectOneMenu>
                    <p:message for="findOrd" display="tooltip" severity="error"/>

                    <p:inputText id="pathOrd" required="true" value="#{movimientoInternoBean.value}"/>
                    <p:message for="pathOrd" display="tooltip" severity="error"/>

                    <p:commandButton value="Buscar" icon="fa fa-fw fa-search"
                                     update=":fford, :fdtord:dtord"
                                     actionListener="#{movimientoInternoBean.findOrden(evt)}"/>
                </h:panelGrid>
            </p:panel>
        </h:form>
        <h:outputText value="&lt;br/&gt;" escape="false"/>
        <h:form id="fdtord">
            <p:panel>
                <p:dataTable id="dtord" var="ord" value="#{movimientoInternoBean.lazyModel}"
                             selectionMode="single" selection="#{movimientoInternoBean.selected}"
                             rows="5" paginator="true" paginatorPosition="bottom" 
                             reflow="true" lazy="true">

                    <p:ajax event="rowSelect" listener="#{movimientoInternoBean.onRowSelect}" 
                            update=":ford:outWizard"/>

                    <f:facet name="header">
                        <h:outputText value="ORDENES"/>
                    </f:facet>
                    <p:column headerText="Fecha" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.lastChange}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Código ORD" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.codigo}"/>
                    </p:column>
                    <p:column headerText="Número ORD" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.numeroOrden}"/>
                    </p:column>
                    <p:column headerText="Número Ticket" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.numeroTicket}"/>
                    </p:column>
                    <p:column headerText="Cliente" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.cliente.nombres}  "/>
                        <h:outputText value="#{ord.cliente.apellidos}"/>
                    </p:column>
                    <p:column headerText="Teléfono" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.cliente.telefono}"/>
                    </p:column>
                    <p:column headerText="Movil" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.cliente.movil}"/>
                    </p:column>
                    <p:column headerText="Producto" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.producto.artefacto}"/>
                    </p:column>
                    <p:column headerText="Marca" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.producto.marca}"/>
                    </p:column>
                    <p:column headerText="Serie" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.producto.serie}"/>
                    </p:column>
                    <p:column headerText="PNC" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.producto.pnc}"/>
                    </p:column>
                    <p:column headerText="Placa" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.producto.placa}"/>
                    </p:column>
                    <p:column headerText="Usuario" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.username.datosPersonales.nombres}"/>
                    </p:column>
                    <p:column headerText="Estado" style="text-align: center;font-size: 75%">
                        <h:outputText value="#{ord.ciclo.abierta.alias} " rendered="#{ord.ciclo.abierta.active}"/>
                        <h:outputText value="#{ord.ciclo.abierta.username.datosPersonales.nombres}" rendered="#{ord.ciclo.abierta.active}"/>
                        <h:outputText value="#{ord.ciclo.cerrada.alias} " rendered="#{ord.ciclo.cerrada.active}"/>
                        <h:outputText value="#{ord.ciclo.cerrada.username.datosPersonales.nombres}" rendered="#{ord.ciclo.cerrada.active}"/>
                        <h:outputText value="#{ord.ciclo.pendiente.alias} " rendered="#{ord.ciclo.pendiente.active}"/>
                        <h:outputText value="#{ord.ciclo.pendiente.username.datosPersonales.nombres}" rendered="#{ord.ciclo.pendiente.active}"/>
                    </p:column>
                </p:dataTable>
            </p:panel>
        </h:form>
        <h:outputText value="&lt;br/&gt;" escape="false"/>
        <h:form id="ford">
            <p:outputPanel id="outWizard">
                <p:panel header="Registro de Moviemintos Internos" rendered="#{movimientoInternoBean.active}">
                    <p:dataTable var="cmt" value="#{movimientoInternoBean.find.movimientosInternos}"
                                 tableStyle="width: auto">
                        <p:column>
                            <h:outputText value="#{cmt.index + 1}" />
                        </p:column>
                        <p:column headerText="Fecha">
                            <h:outputText value="#{cmt.creationDate}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Comentario">
                            <h:outputText value="#{cmt.texto}" />
                        </p:column>
                        <p:column headerText="Usuario">
                            <h:outputText value="#{cmt.username.datosPersonales.nombres}"/>
                        </p:column>
                    </p:dataTable>
                    <h:panelGrid columns="2" cellpadding="5">
                        <p:outputLabel value="Comentario:"/>
                        <p:inputTextarea value="#{movimientoInternoBean.texto}" rows="6" cols="30" style="width: auto"/>
                        <p:commandButton value="Guardar" update=":ford:outWizard"
                                         actionListener="#{movimientoInternoBean.add(evt)}"/>
                    </h:panelGrid>
                </p:panel>
            </p:outputPanel>
        </h:form>
    </ui:define>

</ui:composition>
